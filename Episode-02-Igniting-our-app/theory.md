# Notes:

## What is a production ready code?
- Current code should not be deployed to production.
- The code should not have **comments**.
- The code should not have `console.log`.
- The code should be **minified**.
- The code should be **bundled**.
- The code should be **compressed**.
- If an app has images, the images should be optimized.
- There you need to do:
    - **Bundling**
    - **Code splitting**
    - **Chunking**
    - **Image optimization**
    - **Compression**
    - **Minification**
    - **Print Removal** `console.log`
> React alone cannot make a production ready app.

## What is npm?
- Abbreviation of **npm** is not ~~Node Package Manager~~.
- npm does not have a fullform.
- Although it is a package manager which manages Node packages.
- npm is used to install **packages** or **dependencies**.

## What is package.json?
- It is a configuration file for the npm in JSON format.
- It keeps the **metadata** about the project including **_name_**, **_version_**, **_description_**, **_entry point_**, **_scripts_** and most importantly a list of **_dependencies_**.
- npm stores the **version ranges** of different packages / dependencies in the package.json.
- It does not store exact versions of packages.
- It stores the package and its version range as **key-value** pair in the package.json.
- It keeps a **Caret** (`^`) & **Tilde** (`~`) to maintain the versions.
- There are two types of dependencies:
    - **Dev dependencies** (`devDependencies`)
    - **Normal dependencies** (`dependencies`)
- **Dev dependencies** are required for the development of the application.
- **Normal dependencies** are required in the production also.
- It is human readable and is intended for developers to manually edit and configure.
- It is often shared in the GIT.
- Command to create a package.json:
```
npm init
```
- This command will prompt questions seeking information related the project.
- The answers from the User will be stored as metadata.

## What is package-lock.json?
- This file is automatically generated when `npm install` command is run.
- It locks the dependency tree.
- It ensures that the **exact versions** of dependencies and sub-dependencies are installed everytime.
- It is not intended to edit manually.
- It is also shared in the GIT.
- There are various keys in package-lock.json file like version, resolved, integrity, dev, requires etc.
    - version keeps the exact version.
    - integrity keeps a sha hash to verify the code difference.


## Difference between Caret (`^`) and Tilde (`~`)?
- **Caret (`^`)**
    - It allows updates within the same **major version**.
    - It allows updates that **do not change** the **leftmost non-zero** digit.
    - It ensures **backward-compatibility** within the same major version.
    - E.g.
        - Package version `^1.2.3` matches `1.x.x`
        - `x` can be anything `>=2.3`
        - `1.2.4` & `1.3.0` etc. will match.
        - `2.0.0` will not match.
- **Tilde (`^`)**
    - It allows updates within the same **minor version**.
    - It allows updates only for the **patch version** (or the **minor version** if no patch version is specified).
    - It restricts the updates to only **patch-level** changes.
    - It ensures greater stability while allowing some flexibility.
    - E.g.
        - Package version `~1.2.3` matches `1.2.x`
        - `x` can be anything `>=3`
        - `1.2.4` & `1.2.5` etc. will match.
        - `1.3.0` will not match.
    - E.g.
        - Packge version `~1.2` will match `1.2.x`.
        - `1.2.0` & `1.2.1` etc. will match.
        - `1.3.x` will not match.

## What is a Bundler?
- The most important package in any project.
- Before moving the code to production, the code need to be cleaned, minified, cached and bundled.
- The Bundler is the package which makes all these changes to the code.
- E.g. of a Bundlers is **_Webpack_**, **_Parcel_**, **_Vite_**.
- This project will use **_Parcel_** as a Bundler.
- Command:
```
npm install parcel
```
- Since parcel is used to bundle the developed code.
- Therefore, the Parcel will not be required on the production.
- Hence, it should be installed as a `devDependency`.
- Command:
```
npm install -D parcel
```

## What are node_modules?
- The Packages installed using npm are downloaded and kept as `node_modules`.
- `node_modules` are kept inside the project directory.
- Every installed dependency has its own list of dependencies. Further those list of dependencies has their list.
- This process continues for all the dependencies and ultimately a **Dependency Tree** is created.
- Therefore, these are called as **Transitive Dependencies**.

## How many package.json & packge-lock.json can be there in a project?
- Since, dependencies are transitive i.e. every package has it own list of dependencies.
- Every package keeps its own package.json.
- Hence, there can be multiple package.json and package-lock.json in a project.

## Is the node_modules folder required in the project's GIT repository?
- **No**
- It should be ignored in the GIT using `.gitignore`.
- This is not mandatory because it can be recreated using the package.json and package-lock.json.

## Should you keep the package.json and the package-lock.json in the GIT?
- **Yes**
- These files will be required to install the exact dependencies with their exact versions in the project.
- Which will create the node_modules as well.

## What is .gitignore file?
- Some files are not required to be pushed to the GIT repository.
- These files are ignore from the GIT using the `.gitignore` file.
- Individual files, Folders and even patterns can be configured in the `.gitignore` file.

## What is npx?
- npx is a command to execute packages.

## Bundling the app with parcel.
- Command:
```
npx parcel index.html
```
- `npx` command is used to execute the packages.
- `index.html` is the source file of our project.
- Parcel creates a local server.
- Creates a development build.
- Hosts the development build on a local server.

## Why not CDN links?
- CDN is not a preferred way to import.
- Having **React** or other packages in the `node_modules` is better because:
    - Costly operation
    - The URL will keep changing when packages upgrade.

## Install React & ReactDOM
- Since React will be always required to run the project, It will a normal dependency.
- Command to install **React**:
```
npm install react
```
- Command (shorthand):
```
npm i react-dom
```
- It will be installed and a new key is added in the package.json named **dependencies**.
- An entry for the React will be done under **dependencies**.
- Command to install **ReactDOM**
```
npm install react-dom
```
- Command (shorthand) to install **ReactDOM**
```
npm i react-dom
```
- You can remove the CDN links now.
- After removing the CDN links, you will following error:
```
Uncaught ReferenceError: React is not defined
    at App.js:10:16
```
- Since you have remove the CDN links, the React has to be imported in a different way.
- **Import React**
- Command:
```
import React from "react";
```
- This imported React refers to the installed React in our node_modules.
- **Import ReactDOM**
- Command:
```
import ReactDOM from "react-dom";
```
- Run the dev server again and again you will see another error:
```
@parcel/transformer-js: Browser scripts cannot have imports or exports.
/home/ranosys/Documents/learning/namaste-react/Episode-02-Igniting-our-app/App.js:1:1
> 1 | import React from "react";
>   | ^^^^^^^^^^^^^^^^^^^^^^^^^^
  2 | 
  3 | // nested elements/home/ranosys/Documents/learning/namaste-react/Episode-02-Igniting-our-app/index.html:12:5
  11 |     <div id="root">
> 12 |         <h1>Mohit is here!</h1>
>    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ The environment was originally created here
  13 |     </div>
  14 | 
Add the type="module" attribute to the <script> tag.

```
- Firstly, this colorful error is displayed by Parcel.
- The error means:
- The syntax `<script src="./App.js"></script>` considered as **browser script**.
- Our **App.js** is considered as a normal javscript file and so getting imported as a normal javascript import. Therefore, the error `Browser scripts cannot have imports or exports.`.
- But since it is not a normal javscript file, it has React import, it is a **Module**.
- To resolve this you need to change **normal import** to a **module import**.
- The Error also suggests a resolution `Add the type="module" attribute to the <script> tag.`.
- Updated syntax:
```
<script type="module" src="./App.js"></script>
```
- Now the server is up but a warning is here:
```
Warning: You are importing createRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".
```
- It means the react-dom should be imported in a new way. Although it is allowing it but it will not be supported later.
- Updated syntax
```
import ReactDOM from "react-dom/client";
```



## What parcel does?
- Parcel does a lot of things under the hood like:
    - Shows proper formatted errors
    - Spins up a local development server on http://localhost:1234
    - Creates two folders viz. `.parcel-cache` & `dist`
        - `.parcel-cache` contains the cached files.
        - `dist` contains the development build.
        - `dist` contains `.html`, `.js` and `.js.map` files.
        - The `.js` files are different than our source code files but contains the content.
    - Caching for faster builds.
        - Everytime you save a file, Parcel creates a cache of the build in the `.parcel-cache` folder, so next time the local server will spin even faster.
    - HMR (Hot module replacement)
        - Automatically rendering the new code on the browser.
        - It uses a **file watching algorithm** do HMR.
    - Image Optimization
    - Minification
    - Bundling
    - File compression
    - Consistent Hashing
    - Code Splitting
    - Differential Bundling
        - Ability to support older browsers
    - Diagnostics
    - Error handling
    - HTTPs
        - Ability to run the server as HTTPs
    - Tree Shaking
        - Remove unused code
    - Different dev and prod builds
    - and many more... **Read Parcel documentation.**
- > React apps are faster not just because React is fast but rather one of the main reason is Parcel. It works at the back to make React fast.
- > All this information will be helpful in **System Design Interviews**.

## Read parcel app documentation


## How to create a prod build
- A production build is different than a development build.
- Command:
```
npx parcel build index.html
```
- Only difference is an extra keyword `build` in the dev build command.
- Run the command and you will see following error:
```
🚨 Build failed.

@parcel/namer-default: Target "main" declares an output file path of "App.js" which does not match the compiled bundle type "html".

  /home/ranosys/Documents/learning/namaste-react/package.json:5:11
    4 |   "description": "This project contains all the knowledge acquired from the 'Namaste React' course by 'Akshay Saini'.",
  > 5 |   "main": "App.js",
  >   |           ^^^^^^^^ Did you mean "App.html"?
    6 |   "scripts": {
    7 |     "test": "jest"

  💡 Try changing the file extension of "main" in package.json.
```
- Parcel conflicts with the entry point mentioned in the package.json `"main": "App.js",`. It is expecting an `.html` but found `.js` i.e. `App.js`.
- To resolve this you need to remove the `"main": "App.js",` from the package.json.
- The error is suggesting to change the file extension of the "main" in package.json `Try changing the file extension of "main" in package.json.`
- So, remove the "main" from the package.json and rebuild the prod build.
- Parcel will create build and will create only three files i.e. **one html**, **one js** and **one css** in the `dist` folder.
- **Any number of files in your project will be unified to just three files.**
- This entire code is compressed, minified, tree shaked etc. i.e. completely optimized.
- The files from the dist folder is used run code in the production.
- Since `dist` and `.parcel-cache` is automatically generated using the build command. Therefore, should not be kept in the repository.
- So, `dist` and `.parcel-cache` are also kept in `.gitignore`.
- Updated `.gitignore` file:
```
/node_modules
/dist
/.parcel-cache
```

## Make app compatible with older versions of browsers.
- There is a package named `browserslist` which can make the app compatible with different browser versions.
- We need to instruct to support the provided versions.
- This configured in the package.json.
- Add another entry in the package.json by `"browserslist"`. This will take an array of browsers to be supported.
- Use the browserslist website to get the valid inputs.
- `"last 2 Chrome version"`: It will support the last 2 chrome versions.
- `"last 2 Firefox version"`: It will support the last 2 firefox versions.
- You can also give country specific entry etc.
- This configuration means the App will definitely support the provided versions.
- But more the entires more the builds created.
- Therefore, the recommended way is to generalize the build to cover most browsers and also keep the build light.
- Add following to the package.json
```
"browserslist": [
    "last 2 versions"
  ]
```

## What is map files css & js

> Everthing what we did is what create-react-app does. Hence, we created our own **create-react-app**. An optimized production ready application.
